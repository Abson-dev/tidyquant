<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Aggregates a group of returns by asset into portfolio returns — tq_portfolio • tidyquant</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tidyquant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/TQ00-introduction-to-tidyquant.html">Introduction to tidyquant</a>
    </li>
    <li>
      <a href="../articles/TQ01-core-functions-in-tidyquant.html">Core functions</a>
    </li>
    <li>
      <a href="../articles/TQ02-quant-integrations-in-tidyquant.html">Quantitative integrations</a>
    </li>
    <li>
      <a href="../articles/TQ03-scaling-and-modeling-with-tidyquant.html">Scaling and modeling</a>
    </li>
    <li>
      <a href="../articles/TQ04-charting-with-tidyquant.html">Charting</a>
    </li>
    <li>
      <a href="../articles/TQ05-performance-analysis-with-tidyquant.html">Performance analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/business-science/tidyquant">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Aggregates a group of returns by asset into portfolio returns</h1>
    </div>

    
    <p>Aggregates a group of returns by asset into portfolio returns</p>
    

    <pre class="usage"><span class='fu'>tq_portfolio</span>(<span class='no'>data</span>, <span class='no'>assets_col</span>, <span class='no'>returns_col</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>col_rename</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>tq_portfolio_</span>(<span class='no'>data</span>, <span class='no'>assets_col</span>, <span class='no'>returns_col</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>col_rename</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>tq_repeat_df</span>(<span class='no'>data</span>, <span class='no'>n</span>, <span class='kw'>index_col_name</span> <span class='kw'>=</span> <span class='st'>"portfolio"</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A <code>tibble</code> (tidy data frame) of returns in tidy format (i.e long format).</p></td>
    </tr>
    <tr>
      <th>assets_col</th>
      <td><p>The column with assets (securities)</p></td>
    </tr>
    <tr>
      <th>returns_col</th>
      <td><p>The column with returns</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>Optional parameter for the asset weights, which can be passed as a numeric vector the length of
the number of assets or a two column tibble with asset names in first column
and weights in second column.</p></td>
    </tr>
    <tr>
      <th>col_rename</th>
      <td><p>A string or character vector containing names that can be used
to quickly rename columns.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional parameters passed to <code>PerformanceAnalytics::Returns.portfolio</code></p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>Number of times to repeat a data frame row-wise.</p></td>
    </tr>
    <tr>
      <th>index_col_name</th>
      <td><p>A renaming function for the "index" column, used when repeating data frames.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns data in the form of a <code>tibble</code> object.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>tq_portfolio</code> is a wrapper for <code>PerformanceAnalytics::Returns.portfolio</code>.
The main advantage is the results are returned as a <code>tibble</code> and the
function can be used with the <code>tidyverse</code>.
    <code>assets_col</code> and <code>returns_col</code> are columns within <code>data</code> that are used
to compute returns for a portfolio. The columns should be in "long" format (or "tidy" format)
meaning there is only one column containing all of the assets and one column containing
all of the return values (i.e. not in "wide" format with returns spread by asset).
    <code>weights</code> are the weights to be applied to the asset returns.
Weights can be input in one of three options:</p><ul>
<li><p>Single Portfolio: A numeric vector of weights that is the same length as unique number of assets.
The weights are applied in the order of the assets.</p></li>
<li><p>Single Portfolio: A two column tibble with assets in the first column and weights in the second column.
The advantage to this method is the weights are mapped to the assets and any unlisted
assets default to a weight of zero.</p></li>
<li><p>Multiple Portfolios: A three column tibble with portfolio index in the first
column, assets in the second column, and weights in the third column. The tibble
must be grouped by portfolio index.</p></li>
</ul><p><code>tq_repeat_df</code> is a simple function that repeats
a data frame <code>n</code> times row-wise (long-wise), and adds a new column for a portfolio index.
The function is used to assist in Multiple Portfolio analyses, and
is a useful precursor to <code>tq_portfolio</code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <ul>
<li><p><code><a href='tq_mutate.html'>tq_transmute()</a></code> which can be used to get period returns.</p></li>
<li><p><code><a href='http://www.rdocumentation.org/packages/PerformanceAnalytics/topics/Return.portfolio'>PerformanceAnalytics::Return.portfolio()</a></code> which is the underlying function
that specifies which parameters can be passed via <code>...</code></p></li>
</ul>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Load libraries</span>
<span class='fu'>library</span>(<span class='no'>tidyquant</span>)

<span class='co'># Use FANG data set</span>
<span class='fu'>data</span>(<span class='no'>FANG</span>)

<span class='co'># Get returns for individual stock components</span>
<span class='no'>monthly_returns_stocks</span> <span class='kw'>&lt;-</span> <span class='no'>FANG</span> <span class='kw'>%&gt;%</span>
    <span class='fu'>group_by</span>(<span class='no'>symbol</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='tq_mutate.html'>tq_transmute</a></span>(<span class='no'>adjusted</span>, <span class='no'>periodReturn</span>, <span class='kw'>period</span> <span class='kw'>=</span> <span class='st'>"monthly"</span>)

<span class='co'>##### Portfolio Aggregation Methods #####</span>

<span class='co'># Method 1: Use tq_portfolio with numeric vector of weights</span>

<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>0.50</span>, <span class='fl'>0.25</span>, <span class='fl'>0.25</span>, <span class='fl'>0</span>)
<span class='fu'>tq_portfolio</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>monthly_returns_stocks</span>,
             <span class='kw'>assets_col</span> <span class='kw'>=</span> <span class='no'>symbol</span>,
             <span class='kw'>returns_col</span> <span class='kw'>=</span> <span class='no'>monthly.returns</span>,
             <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>weights</span>,
             <span class='kw'>col_rename</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
             <span class='kw'>wealth.index</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A tibble: 48 × 2
#&gt;          date portfolio.returns
#&gt;        &lt;date&gt;             &lt;dbl&gt;
#&gt; 1  2013-01-31       0.260144557
#&gt; 2  2013-02-28      -0.004558003
#&gt; 3  2013-03-28      -0.019454685
#&gt; 4  2013-04-30       0.080958243
#&gt; 5  2013-05-31      -0.013883075
#&gt; 6  2013-06-28      -0.017906983
#&gt; 7  2013-07-31       0.253520291
#&gt; 8  2013-08-30       0.103866369
#&gt; 9  2013-09-30       0.145446247
#&gt; 10 2013-10-31       0.041956895
#&gt; # ... with 38 more rows</div><div class='input'>
<span class='co'># Method 2: Use tq_portfolio with two column tibble and map weights</span>

<span class='co'># Note that GOOG's weighting is zero in Method 1. In Method 2,</span>
<span class='co'># GOOG is not added and same result is achieved.</span>
<span class='no'>weights_df</span> <span class='kw'>&lt;-</span> <span class='fu'>tibble</span>(<span class='kw'>symbol</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"FB"</span>, <span class='st'>"AMZN"</span>, <span class='st'>"NFLX"</span>),
                     <span class='kw'>weights</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='fl'>0.50</span>, <span class='fl'>0.25</span>, <span class='fl'>0.25</span>))
<span class='fu'>tq_portfolio</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>monthly_returns_stocks</span>,
             <span class='kw'>assets_col</span> <span class='kw'>=</span> <span class='no'>symbol</span>,
             <span class='kw'>returns_col</span> <span class='kw'>=</span> <span class='no'>monthly.returns</span>,
             <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>weights_df</span>,
             <span class='kw'>col_rename</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
             <span class='kw'>wealth.index</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; # A tibble: 48 × 2
#&gt;          date portfolio.returns
#&gt;        &lt;date&gt;             &lt;dbl&gt;
#&gt; 1  2013-01-31       0.260144557
#&gt; 2  2013-02-28      -0.004558003
#&gt; 3  2013-03-28      -0.019454685
#&gt; 4  2013-04-30       0.080958243
#&gt; 5  2013-05-31      -0.013883075
#&gt; 6  2013-06-28      -0.017906983
#&gt; 7  2013-07-31       0.253520291
#&gt; 8  2013-08-30       0.103866369
#&gt; 9  2013-09-30       0.145446247
#&gt; 10 2013-10-31       0.041956895
#&gt; # ... with 38 more rows</div><div class='input'>
<span class='co'># Method 3: Working with multiple portfolios</span>

<span class='co'># 3A: Duplicate monthly_returns_stocks multiple times</span>
<span class='no'>mult_monthly_returns_stocks</span> <span class='kw'>&lt;-</span> <span class='fu'>tq_repeat_df</span>(<span class='no'>monthly_returns_stocks</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>4</span>)</div><div class='output co'>#&gt; <span class='message'>Ungrouping data frame groups: symbol</span></div><div class='input'>
<span class='co'># 3B: Create weights table grouped by portfolio id</span>
<span class='no'>weights</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>0.50</span>, <span class='fl'>0.25</span>, <span class='fl'>0.25</span>, <span class='fl'>0.00</span>,
             <span class='fl'>0.00</span>, <span class='fl'>0.50</span>, <span class='fl'>0.25</span>, <span class='fl'>0.25</span>,
             <span class='fl'>0.25</span>, <span class='fl'>0.00</span>, <span class='fl'>0.50</span>, <span class='fl'>0.25</span>,
             <span class='fl'>0.25</span>, <span class='fl'>0.25</span>, <span class='fl'>0.00</span>, <span class='fl'>0.50</span>)
<span class='no'>stocks</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='st'>"FB"</span>, <span class='st'>"AMZN"</span>, <span class='st'>"NFLX"</span>, <span class='st'>"GOOG"</span>)
<span class='no'>weights_table</span> <span class='kw'>&lt;-</span> <span class='fu'>tibble</span>(<span class='no'>stocks</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'>tq_repeat_df</span>(<span class='kw'>n</span> <span class='kw'>=</span> <span class='fl'>4</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'>bind_cols</span>(<span class='fu'>tibble</span>(<span class='no'>weights</span>)) <span class='kw'>%&gt;%</span>
    <span class='fu'>group_by</span>(<span class='no'>portfolio</span>)

<span class='co'># 3C: Scale to multiple portfolios</span>
<span class='fu'>tq_portfolio</span>(<span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>mult_monthly_returns_stocks</span>,
             <span class='kw'>assets_col</span> <span class='kw'>=</span> <span class='no'>symbol</span>,
             <span class='kw'>returns_col</span> <span class='kw'>=</span> <span class='no'>monthly.returns</span>,
             <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>weights_table</span>,
             <span class='kw'>col_rename</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
             <span class='kw'>wealth.index</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)</div><div class='output co'>#&gt; Source: local data frame [192 x 3]
#&gt; Groups: portfolio [4]
#&gt; 
#&gt;    portfolio       date portfolio.returns
#&gt;        &lt;int&gt;     &lt;date&gt;             &lt;dbl&gt;
#&gt; 1          1 2013-01-31       0.260144557
#&gt; 2          1 2013-02-28      -0.004558003
#&gt; 3          1 2013-03-28      -0.019454685
#&gt; 4          1 2013-04-30       0.080958243
#&gt; 5          1 2013-05-31      -0.013883075
#&gt; 6          1 2013-06-28      -0.017906983
#&gt; 7          1 2013-07-31       0.253520291
#&gt; 8          1 2013-08-30       0.103866369
#&gt; 9          1 2013-09-30       0.145446247
#&gt; 10         1 2013-10-31       0.041956895
#&gt; # ... with 182 more rows</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
