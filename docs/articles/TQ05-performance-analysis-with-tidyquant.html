<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Performance Analysis with tidyquant • tidyquant</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tidyquant</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Function Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/TQ00-introduction-to-tidyquant.html">Introduction to tidyquant</a>
    </li>
    <li>
      <a href="../articles/TQ01-core-functions-in-tidyquant.html">Core functions</a>
    </li>
    <li>
      <a href="../articles/TQ02-quant-integrations-in-tidyquant.html">Quantitative integrations</a>
    </li>
    <li>
      <a href="../articles/TQ03-scaling-and-modeling-with-tidyquant.html">Scaling and modeling</a>
    </li>
    <li>
      <a href="../articles/TQ04-charting-with-tidyquant.html">Charting</a>
    </li>
    <li>
      <a href="../articles/TQ05-performance-analysis-with-tidyquant.html">Performance Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/business-science/tidyquant">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Performance Analysis with tidyquant</h1>
                        <h4 class="author">Matt Dancho</h4>
            
            <h4 class="date">2017-04-09</h4>
          </div>

    
    
<div class="contents">
<blockquote>
<p>Tidy analysis of stock and portfolio return performance with <code>PerformanceAnalytics</code></p>
</blockquote>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>Financial asset (individual stocks, securities, etc) and portfolio (groups of stocks, securities, etc) performance analysis is a deep field with a wide range of theories and methods for analyzing risk versus reward. The <code>PerformanceAnalytics</code> package consolidates functions to compute many of the most widely used performance metrics. <code>tidquant</code> integrates this functionality so it can be used at scale using the split, apply, combine framework within the <code>tidyverse</code>. Two primary functions integrate the performance analysis functionality:</p>
<ul>
<li>
<code>tq_performance</code> implements the performance analysis functions in a tidy way, enabling scaling analysis using the split, apply, combine framework.</li>
<li>
<code>tq_portfolio</code> provides a useful tool set for aggregating a group of individual asset returns into one or many portfolios.</li>
</ul>
<p>This vignette aims to cover three aspects of performance analysis:</p>
<ol style="list-style-type: decimal">
<li><p>The general workflow to go from start to finish on both an asset and a portfolio level</p></li>
<li><p>Some of the available techniques to implement once the workflow is implemented</p></li>
<li><p>How to customize <code>tq_portfolio</code> and <code>tq_performance</code> using the <code>...</code> parameter</p></li>
</ol>
</div>
<div id="key-concepts" class="section level1">
<h1 class="hasAnchor">
<a href="#key-concepts" class="anchor"></a>Key Concepts</h1>
<p>An important concept is that performance analysis is based on the statistical properties of <strong>returns</strong> (not prices). As a result, this package uses inputs of <strong>time-based returns as opposed to stock prices</strong>. The arguments change to <code>Ra</code> for the asset returns and <code>Rb</code> for the baseline returns. We’ll go over how to get returns in the <a href="#workflow">Workflow</a> section.</p>
<p>Another important concept is the <strong>baseline</strong>. The baseline is what you are measuring performance against. A baseline can be anything, but in many cases it’s a representative average of how an investment might perform with little or no effort. Often indexes such as the S&amp;P500 are used for general market performance. Other times more specific Exchange Traded Funds (ETFs) are used such as the <a href="http://www.sectorspdr.com/sectorspdr/sector/xlk/holdings">SPDR Technology ETF (XLK)</a>. The important concept here is that you measure the asset performance (<code>Ra</code>) against the baseline (<code>Rb</code>).</p>
<p>Now for a quick tutorial to show off the <code>PerformanceAnalytics</code> package integration.</p>
</div>
<div id="quick-example" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-example" class="anchor"></a>Quick Example</h1>
<p>One of the most widely used risk to return metrics is the <a href="http://www.investopedia.com/terms/c/capm.asp">Capital Asset Pricing Model (CAPM)</a>. According to Investopedia:</p>
<blockquote>
<p>The capital asset pricing model (CAPM) is a model that describes the relationship between systematic risk and expected return for assets, particularly stocks. CAPM is widely used throughout finance for the pricing of risky securities, generating expected returns for assets given the risk of those assets and calculating costs of capital.</p>
</blockquote>
<p>We’ll use the <code>PerformanceAnalytics</code> function, <code>table.CAPM</code>, to evaluate the returns of several technology stocks against the SPDR Technology ETF (XLK).</p>
<p>First, load the <code>tidyquant</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyquant)</code></pre></div>
<p>Second, get the stock returns for the stocks we wish to evaluate. We use <code>tq_get</code> to get stock prices from Yahoo Finance, <code>group_by</code> to group the stock prices related to each symbol, and <code>tq_transmute</code> to retrieve period returns in a monthly periodicity using the “adjusted” stock prices (adjusted for stock splits, which can throw off returns, affecting the performance analysis). Review the output and see that there are three groups of symbols indicating the data has been grouped appropriately.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Ra &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(symbol) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Ra"</span>)
Ra</code></pre></div>
<pre><code>## Source: local data frame [216 x 3]
## Groups: symbol [3]
## 
##    symbol       date          Ra
##     &lt;chr&gt;     &lt;date&gt;       &lt;dbl&gt;
## 1    AAPL 2010-01-29 -0.10256526
## 2    AAPL 2010-02-26  0.06539619
## 3    AAPL 2010-03-31  0.14847041
## 4    AAPL 2010-04-30  0.11102125
## 5    AAPL 2010-05-28 -0.01612472
## 6    AAPL 2010-06-30 -0.02082686
## 7    AAPL 2010-07-30  0.02274081
## 8    AAPL 2010-08-31 -0.05500481
## 9    AAPL 2010-09-30  0.16721508
## 10   AAPL 2010-10-29  0.06072249
## # ... with 206 more rows</code></pre>
<p>Next, we get the baseline prices. We’ll use the XLK. Note that there is no need to group because we are just getting one data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Rb &lt;-<span class="st"> "XLK"</span> %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Rb"</span>)
Rb</code></pre></div>
<pre><code>## # A tibble: 72 × 2
##          date          Rb
##        &lt;date&gt;       &lt;dbl&gt;
## 1  2010-01-29 -0.09926952
## 2  2010-02-26  0.03482833
## 3  2010-03-31  0.06839787
## 4  2010-04-30  0.01255411
## 5  2010-05-28 -0.07481831
## 6  2010-06-30 -0.05396629
## 7  2010-07-30  0.07450982
## 8  2010-08-31 -0.05611312
## 9  2010-09-30  0.11663646
## 10 2010-10-29  0.05777587
## # ... with 62 more rows</code></pre>
<p>Now, we combine the two data sets using the “date” field using <code>left_join</code> from the <code>dplyr</code> package. Review the results and see that we still have three groups of returns, and columns “Ra” and “Rb” are side-by-side.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb &lt;-<span class="st"> </span><span class="kw">left_join</span>(Ra, Rb, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"date"</span> =<span class="st"> "date"</span>))
RaRb</code></pre></div>
<pre><code>## Source: local data frame [216 x 4]
## Groups: symbol [?]
## 
##    symbol       date          Ra          Rb
##     &lt;chr&gt;     &lt;date&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1    AAPL 2010-01-29 -0.10256526 -0.09926952
## 2    AAPL 2010-02-26  0.06539619  0.03482833
## 3    AAPL 2010-03-31  0.14847041  0.06839787
## 4    AAPL 2010-04-30  0.11102125  0.01255411
## 5    AAPL 2010-05-28 -0.01612472 -0.07481831
## 6    AAPL 2010-06-30 -0.02082686 -0.05396629
## 7    AAPL 2010-07-30  0.02274081  0.07450982
## 8    AAPL 2010-08-31 -0.05500481 -0.05611312
## 9    AAPL 2010-09-30  0.16721508  0.11663646
## 10   AAPL 2010-10-29  0.06072249  0.05777587
## # ... with 206 more rows</code></pre>
<p>Finally, we can retrieve the performance metrics using <code><a href="../reference/tq_performance.html">tq_performance()</a></code>. You can use <code><a href="../reference/tq_performance.html">tq_performance_fun_options()</a></code> to see the full list of compatible performance functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_capm &lt;-<span class="st"> </span>RaRb %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, 
                   <span class="dt">Rb =</span> Rb, 
                   <span class="dt">performance_fun =</span> table.CAPM)
RaRb_capm</code></pre></div>
<pre><code>## Source: local data frame [3 x 13]
## Groups: symbol [3]
## 
##   symbol ActivePremium  Alpha AnnualizedAlpha   Beta `Beta-` `Beta+`
##    &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1   AAPL        0.1176 0.0087          0.1099 1.1229  0.6366  1.0427
## 2   GOOG        0.0331 0.0028          0.0341 1.1376  1.3598  1.1651
## 3   NFLX        0.4440 0.0527          0.8514 0.3983 -1.5180  0.0048
## # ... with 6 more variables: Correlation &lt;dbl&gt;,
## #   `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;,
## #   TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;</code></pre>
<p>We can quickly isolate attributes, such as alpha, the measure of growth, and beta, the measure of risk.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_capm %&gt;%
<span class="st">    </span><span class="kw">select</span>(Alpha, Beta)</code></pre></div>
<pre><code>## Source: local data frame [3 x 3]
## Groups: symbol [3]
## 
##   symbol  Alpha   Beta
##    &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1   AAPL 0.0087 1.1229
## 2   GOOG 0.0028 1.1376
## 3   NFLX 0.0527 0.3983</code></pre>
<p>With <code>tidyquant</code> it’s efficient and easy to get the CAPM information! And, that’s just one of 128 available functions to analyze stock and portfolio return performance. Just use <code><a href="../reference/tq_performance.html">tq_performance_fun_options()</a></code> to see the full list.</p>
<p><a class="anchor" id="workflow"></a></p>
</div>
<div id="workflow" class="section level1">
<h1 class="hasAnchor">
<a href="#workflow" class="anchor"></a>Workflow</h1>
<p>The general workflow is shown in the diagram below. We’ll step through the workflow first with a group of individual assets (stocks) and then with portfolios of stocks.</p>
<div class="figure">
<img src="perfomance_analysis_workflow.png" alt="Performance Analysis Workflow"><p class="caption">Performance Analysis Workflow</p>
</div>
<div id="individual-assets" class="section level2">
<h2 class="hasAnchor">
<a href="#individual-assets" class="anchor"></a>Individual Assets</h2>
<p>Individual assets are the simplest form of analysis because there is no portfolio aggregation (Step 3A). We’ll re-do the “Quick Example” this time getting the <strong>Sharpe Ratio</strong>, a measure of reward-to-risk.</p>
<p>Before we get started let’s find the performance function we want to use from <code>PerformanceAnalytics</code>. Searching <code>tq_performance_fun_options</code>, we can see that <code>SharpeRatio</code> is available. Type <code>?SharpeRatio</code>, and we can see that the arguments are:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(SharpeRatio)</code></pre></div>
<pre><code>## function (R, Rf = 0, p = 0.95, FUN = c("StdDev", "VaR", "ES"), 
##     weights = NULL, annualize = FALSE, ...) 
## NULL</code></pre>
<p>We can actually skip the baseline path because the function does not require <code>Rb</code>. The function takes <code>R</code>, which is passed using <code>Ra</code> in <code><a href="../reference/tq_performance.html">tq_performance(Ra, Rb, performance_fun, ...)</a></code>. A little bit of foresight saves us some work.</p>
<div id="step-1a-get-stock-prices" class="section level3">
<h3 class="hasAnchor">
<a href="#step-1a-get-stock-prices" class="anchor"></a>Step 1A: Get stock prices</h3>
<p>Use <code><a href="../reference/tq_get.html">tq_get()</a></code> to get stock prices.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_prices &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>)
stock_prices</code></pre></div>
<pre><code>## # A tibble: 4,530 × 8
##    symbol       date   open   high    low  close    volume adjusted
##     &lt;chr&gt;     &lt;date&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1    AAPL 2010-01-04 213.43 214.50 212.38 214.01 123432400 27.72704
## 2    AAPL 2010-01-05 214.60 215.59 213.25 214.38 150476200 27.77498
## 3    AAPL 2010-01-06 214.38 215.23 210.75 210.97 138040000 27.33318
## 4    AAPL 2010-01-07 211.75 212.00 209.05 210.58 119282800 27.28265
## 5    AAPL 2010-01-08 210.30 212.00 209.06 211.98 111902700 27.46403
## 6    AAPL 2010-01-11 212.80 213.00 208.45 210.11 115557400 27.22176
## 7    AAPL 2010-01-12 209.19 209.77 206.42 207.72 148614900 26.91211
## 8    AAPL 2010-01-13 207.87 210.93 204.10 210.65 151473000 27.29172
## 9    AAPL 2010-01-14 210.11 210.46 209.02 209.43 108223500 27.13366
## 10   AAPL 2010-01-15 210.93 211.60 205.87 205.93 148516900 26.68020
## # ... with 4,520 more rows</code></pre>
</div>
<div id="step-2a-mutate-to-returns" class="section level3">
<h3 class="hasAnchor">
<a href="#step-2a-mutate-to-returns" class="anchor"></a>Step 2A: Mutate to returns</h3>
<p>Using the <code>tidyverse</code> split, apply, combine framework, we can mutate groups of stocks by first “grouping” with <code>group_by</code> and then applying a mutating function using <code>tq_transmute</code>. We use the <code>quantmod</code> function <code>periodReturn</code> as the mutating function. We pass along the arguments <code>period = "monthly"</code> to return the results in monthly periodicity. Last, we use the <code>col_rename</code> argument to rename the output column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly &lt;-<span class="st"> </span>stock_prices %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(symbol) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Ra"</span>)
stock_returns_monthly</code></pre></div>
<pre><code>## Source: local data frame [216 x 3]
## Groups: symbol [3]
## 
##    symbol       date          Ra
##     &lt;chr&gt;     &lt;date&gt;       &lt;dbl&gt;
## 1    AAPL 2010-01-29 -0.10256526
## 2    AAPL 2010-02-26  0.06539619
## 3    AAPL 2010-03-31  0.14847041
## 4    AAPL 2010-04-30  0.11102125
## 5    AAPL 2010-05-28 -0.01612472
## 6    AAPL 2010-06-30 -0.02082686
## 7    AAPL 2010-07-30  0.02274081
## 8    AAPL 2010-08-31 -0.05500481
## 9    AAPL 2010-09-30  0.16721508
## 10   AAPL 2010-10-29  0.06072249
## # ... with 206 more rows</code></pre>
</div>
<div id="step-3a-aggregate-to-portfolio-returns-skipped" class="section level3">
<h3 class="hasAnchor">
<a href="#step-3a-aggregate-to-portfolio-returns-skipped" class="anchor"></a>Step 3A: Aggregate to Portfolio Returns (Skipped)</h3>
<p>Step 3A can be skipped because we are only interested in the Sharpe Ratio for <em>individual stocks</em> (not a portfolio).</p>
<p>Step 3B can also be skipped because the <code>SharpeRatio</code> function from <code>PerformanceAnalytics</code> does not require a baseline.</p>
</div>
<div id="step-4-analyze-performance" class="section level3">
<h3 class="hasAnchor">
<a href="#step-4-analyze-performance" class="anchor"></a>Step 4: Analyze Performance</h3>
<p>The last step is to apply the <code>SharpeRatio</code> function to our groups of stock returns. We do this using <code><a href="../reference/tq_performance.html">tq_performance()</a></code> with the arguments <code>Ra = Ra</code>, <code>Rb = NULL</code> (not required), and <code>performance_fun = SharpeRatio</code>. We can also pass other arguments of the <code>SharpeRatio</code> function such as <code>Rf</code>, <code>p</code>, <code>FUN</code>, and <code>annualize</code>. We will just use the defaults for this example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, 
                   <span class="dt">Rb =</span> <span class="ot">NULL</span>, 
                   <span class="dt">performance_fun =</span> SharpeRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: symbol [3]
## 
##   symbol `ESSharpe(Rf=0%,p=95%)` `StdDevSharpe(Rf=0%,p=95%)`
##    &lt;chr&gt;                   &lt;dbl&gt;                       &lt;dbl&gt;
## 1   AAPL               0.1682209                   0.2872497
## 2   GOOG               0.1264633                   0.1992533
## 3   NFLX               0.2351226                   0.2827729
## # ... with 1 more variables: `VaRSharpe(Rf=0%,p=95%)` &lt;dbl&gt;</code></pre>
<p>Now we have the Sharpe Ratio for each of the three stocks. What if we want to adjust the parameters of the function? We can just add on the arguments of the underlying function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, 
                   <span class="dt">Rb =</span> <span class="ot">NULL</span>, 
                   <span class="dt">performance_fun =</span> SharpeRatio, 
                   <span class="dt">Rf =</span> <span class="fl">0.03</span> /<span class="st"> </span><span class="dv">12</span>, 
                   <span class="dt">p =</span> <span class="fl">0.99</span>)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: symbol [3]
## 
##   symbol `ESSharpe(Rf=0.2%,p=99%)` `StdDevSharpe(Rf=0.2%,p=99%)`
##    &lt;chr&gt;                     &lt;dbl&gt;                         &lt;dbl&gt;
## 1   AAPL                0.11304625                     0.2528850
## 2   GOOG                0.08081889                     0.1663198
## 3   NFLX                0.11634192                     0.2703676
## # ... with 1 more variables: `VaRSharpe(Rf=0.2%,p=99%)` &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="portfolios-asset-groups" class="section level2">
<h2 class="hasAnchor">
<a href="#portfolios-asset-groups" class="anchor"></a>Portfolios (Asset Groups)</h2>
<p>Portfolios are slightly more complicated because we are now dealing with groups of assets versus individual stocks, and we need to aggregate weighted returns. Fortunately, this is only one extra step with <code>tidyquant</code> using <code><a href="../reference/tq_portfolio.html">tq_portfolio()</a></code>.</p>
<div id="single-portfolio" class="section level3">
<h3 class="hasAnchor">
<a href="#single-portfolio" class="anchor"></a>Single Portfolio</h3>
<p>Let’s recreate the CAPM analysis in the “Quick Example” this time comparing a portfolio of technology stocks to the SPDR Technology ETF (XLK).</p>
<div id="steps-1a-and-2a-asset-period-returns" class="section level4">
<h4 class="hasAnchor">
<a href="#steps-1a-and-2a-asset-period-returns" class="anchor"></a>Steps 1A and 2A: Asset Period Returns</h4>
<p>This is the same as what we did previously to get the monthly returns for groups of individual stock prices. We use the split, apply, combine framework using the workflow of <code>tq_get</code>, <code>group_by</code>, and <code>tq_transmute</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(symbol) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Ra"</span>)
stock_returns_monthly</code></pre></div>
<pre><code>## Source: local data frame [216 x 3]
## Groups: symbol [3]
## 
##    symbol       date          Ra
##     &lt;chr&gt;     &lt;date&gt;       &lt;dbl&gt;
## 1    AAPL 2010-01-29 -0.10256526
## 2    AAPL 2010-02-26  0.06539619
## 3    AAPL 2010-03-31  0.14847041
## 4    AAPL 2010-04-30  0.11102125
## 5    AAPL 2010-05-28 -0.01612472
## 6    AAPL 2010-06-30 -0.02082686
## 7    AAPL 2010-07-30  0.02274081
## 8    AAPL 2010-08-31 -0.05500481
## 9    AAPL 2010-09-30  0.16721508
## 10   AAPL 2010-10-29  0.06072249
## # ... with 206 more rows</code></pre>
</div>
<div id="steps-1b-and-2b-baseline-period-returns" class="section level4">
<h4 class="hasAnchor">
<a href="#steps-1b-and-2b-baseline-period-returns" class="anchor"></a>Steps 1B and 2B: Baseline Period Returns</h4>
<p>This was also done previously.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baseline_returns_monthly &lt;-<span class="st"> "XLK"</span> %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Rb"</span>)
baseline_returns_monthly</code></pre></div>
<pre><code>## # A tibble: 72 × 2
##          date          Rb
##        &lt;date&gt;       &lt;dbl&gt;
## 1  2010-01-29 -0.09926952
## 2  2010-02-26  0.03482833
## 3  2010-03-31  0.06839787
## 4  2010-04-30  0.01255411
## 5  2010-05-28 -0.07481831
## 6  2010-06-30 -0.05396629
## 7  2010-07-30  0.07450982
## 8  2010-08-31 -0.05611312
## 9  2010-09-30  0.11663646
## 10 2010-10-29  0.05777587
## # ... with 62 more rows</code></pre>
</div>
<div id="step-3a-aggregate-to-portfolio-period-returns" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3a-aggregate-to-portfolio-period-returns" class="anchor"></a>Step 3A: Aggregate to Portfolio Period Returns</h4>
<p>The <code>tidyquant</code> function, <code><a href="../reference/tq_portfolio.html">tq_portfolio()</a></code> aggregates a group of individual assets into a single return using a weighted composition of the underlying assets. To do this we need to first develop portfolio weights. There are two ways to do this for a single portfolio:</p>
<ol style="list-style-type: decimal">
<li>Supplying a vector of weights</li>
<li>Supplying a two column tidy data frame (tibble) with stock symbols in the first column and weights to map in the second.</li>
</ol>
<p>Suppose we want to split our portfolio evenly between AAPL and NFLX. We’ll show this using both methods.</p>
<div id="method-1-aggregating-a-portfolio-using-vector-of-weights" class="section level5">
<h5 class="hasAnchor">
<a href="#method-1-aggregating-a-portfolio-using-vector-of-weights" class="anchor"></a>Method 1: Aggregating a Portfolio using Vector of Weights</h5>
<p>We’ll use the weight vector, <code>c(0.5, 0, 0.5)</code>. Two important aspects to supplying a numeric vector of weights: First, notice that the length (3) is equal to the number of assets (3). This is a requirement. Second, notice that the sum of the weighting vector is equal to 1. This is not “required”, but is best practice. If the sum is not 1, the weights will be distributed accordingly by scaling the vector to 1, and a warning message will appear.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>)
portfolio_returns_monthly &lt;-<span class="st"> </span>stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col  =</span> symbol, 
                 <span class="dt">returns_col =</span> Ra, 
                 <span class="dt">weights     =</span> wts, 
                 <span class="dt">col_rename  =</span> <span class="st">"Ra"</span>)
portfolio_returns_monthly</code></pre></div>
<pre><code>## # A tibble: 72 × 2
##          date          Ra
##        &lt;date&gt;       &lt;dbl&gt;
## 1  2010-01-29  0.03071069
## 2  2010-02-26  0.06293880
## 3  2010-03-31  0.13040921
## 4  2010-04-30  0.23915514
## 5  2010-05-28  0.06821979
## 6  2010-06-30 -0.02188252
## 7  2010-07-30 -0.02723285
## 8  2010-08-31  0.11648599
## 9  2010-09-30  0.25123937
## 10 2010-10-29  0.06742970
## # ... with 62 more rows</code></pre>
<p>We now have an aggregated portfolio that is a 50/50 blend of AAPL and NFLX.</p>
<p>You may be asking why didn’t we use GOOG? <strong>The important thing to understand is that all of the assets from the asset returns don’t need to be used when creating the portfolio!</strong> This enables us to scale individual stock returns and then vary weights to optimize the portfolio (this will be a further subject that we address in the future!)</p>
</div>
<div id="method-2-aggregating-a-portfolio-using-two-column-tibble-with-symbols-and-weights" class="section level5">
<h5 class="hasAnchor">
<a href="#method-2-aggregating-a-portfolio-using-two-column-tibble-with-symbols-and-weights" class="anchor"></a>Method 2: Aggregating a Portfolio using Two Column Tibble with Symbols and Weights</h5>
<p>A possibly more useful method of aggregating returns is using a tibble of symbols and weights that are mapped to the portfolio. We’ll recreate the previous portfolio example using mapped weights.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wts_map &lt;-<span class="st"> </span><span class="kw">tibble</span>(
    <span class="dt">symbols =</span> <span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"NFLX"</span>),
    <span class="dt">weights =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>)
)
wts_map</code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   symbols weights
##     &lt;chr&gt;   &lt;dbl&gt;
## 1    AAPL     0.5
## 2    NFLX     0.5</code></pre>
<p>Next, supply this two column tibble, with symbols in the first column and weights in the second, to the <code>weights</code> argument in <code><a href="../reference/tq_performance.html">tq_performance()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col  =</span> symbol, 
                 <span class="dt">returns_col =</span> Ra, 
                 <span class="dt">weights     =</span> wts_map, 
                 <span class="dt">col_rename  =</span> <span class="st">"Ra_using_wts_map"</span>)</code></pre></div>
<pre><code>## # A tibble: 72 × 2
##          date Ra_using_wts_map
##        &lt;date&gt;            &lt;dbl&gt;
## 1  2010-01-29       0.03071069
## 2  2010-02-26       0.06293880
## 3  2010-03-31       0.13040921
## 4  2010-04-30       0.23915514
## 5  2010-05-28       0.06821979
## 6  2010-06-30      -0.02188252
## 7  2010-07-30      -0.02723285
## 8  2010-08-31       0.11648599
## 9  2010-09-30       0.25123937
## 10 2010-10-29       0.06742970
## # ... with 62 more rows</code></pre>
<p>The aggregated returns are exactly the same. The advantage with this method is that not all symbols need to be specified. Any symbol not specified by default gets a weight of zero.</p>
<p>Now, imagine if you had an entire index, such as the Russell 2000, of 2000 individual stock returns in a nice tidy data frame. It would be very easy to adjust portfolios and compute blended returns, and you only need to supply the symbols that you want to blend. All other symbols default to zero!</p>
</div>
</div>
<div id="step-3b-merging-ra-and-rb" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3b-merging-ra-and-rb" class="anchor"></a>Step 3B: Merging Ra and Rb</h4>
<p>Now that we have the aggregated portfolio returns (“Ra”) from Step 3A and the baseline returns (“Rb”) from Step 2B, we can merge to get our consolidated table of asset and baseline returns. Nothing new here.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_single_portfolio &lt;-<span class="st"> </span><span class="kw">left_join</span>(portfolio_returns_monthly, 
                                   baseline_returns_monthly,
                                   <span class="dt">by =</span> <span class="st">"date"</span>)
RaRb_single_portfolio</code></pre></div>
<pre><code>## # A tibble: 72 × 3
##          date          Ra          Rb
##        &lt;date&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1  2010-01-29  0.03071069 -0.09926952
## 2  2010-02-26  0.06293880  0.03482833
## 3  2010-03-31  0.13040921  0.06839787
## 4  2010-04-30  0.23915514  0.01255411
## 5  2010-05-28  0.06821979 -0.07481831
## 6  2010-06-30 -0.02188252 -0.05396629
## 7  2010-07-30 -0.02723285  0.07450982
## 8  2010-08-31  0.11648599 -0.05611312
## 9  2010-09-30  0.25123937  0.11663646
## 10 2010-10-29  0.06742970  0.05777587
## # ... with 62 more rows</code></pre>
</div>
<div id="step-4-computing-the-capm-table" class="section level4">
<h4 class="hasAnchor">
<a href="#step-4-computing-the-capm-table" class="anchor"></a>Step 4: Computing the CAPM Table</h4>
<p>The CAPM table is computed with the function <code>table.CAPM</code> from <code>PerformanceAnalytics</code>. We just perform the same task that we performed in the “Quick Example”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_single_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.CAPM)</code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   ActivePremium  Alpha AnnualizedAlpha   Beta `Beta-` `Beta+` Correlation
## *         &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;
## 1        0.3251 0.0297          0.4209 0.7648 -0.2186  0.5035      0.2869
## # ... with 5 more variables: `Correlationp-value` &lt;dbl&gt;,
## #   InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;, TrackingError &lt;dbl&gt;,
## #   TreynorRatio &lt;dbl&gt;</code></pre>
<p>Now we have the CAPM performance metrics for a portfolio! While this is cool, it’s cooler to do multiple portfolios. Let’s see how.</p>
</div>
</div>
<div id="multiple-portfolios" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-portfolios" class="anchor"></a>Multiple Portfolios</h3>
<p>Once you understand the process for a single portfolio using Step 3A, Method 2 (aggregating weights by mapping), scaling to multiple portfolios is just building on this concept. Let’s recreate the same example from the “Single Portfolio” Example this time with three portfolios:</p>
<ol style="list-style-type: decimal">
<li>50% AAPL, 25% GOOG, 25% NFLX</li>
<li>25% AAPL, 50% GOOG, 25% NFLX</li>
<li>25% AAPL, 25% GOOG, 50% NFLX</li>
</ol>
<div id="steps-1-and-2-are-the-exact-same-as-the-single-portfolio-example" class="section level4">
<h4 class="hasAnchor">
<a href="#steps-1-and-2-are-the-exact-same-as-the-single-portfolio-example" class="anchor"></a>Steps 1 and 2 are the Exact Same as the Single Portfolio Example</h4>
<p>First, get individual asset returns grouped by asset, which is the exact same as Steps 1A and 1B from the Single Portfolio example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(symbol) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Ra"</span>)</code></pre></div>
<p>Second, get baseline asset returns, which is the exact same as Steps 1B and 2B from the Single Portfolio example.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">baseline_returns_monthly &lt;-<span class="st"> "XLK"</span> %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_get.html">tq_get</a></span>(<span class="dt">get  =</span> <span class="st">"stock.prices"</span>,
           <span class="dt">from =</span> <span class="st">"2010-01-01"</span>,
           <span class="dt">to   =</span> <span class="st">"2015-12-31"</span>) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_mutate.html">tq_transmute</a></span>(<span class="dt">select     =</span> adjusted, 
                 <span class="dt">mutate_fun =</span> periodReturn, 
                 <span class="dt">period     =</span> <span class="st">"monthly"</span>, 
                 <span class="dt">col_rename =</span> <span class="st">"Rb"</span>)</code></pre></div>
</div>
<div id="step-3a-aggregate-portfolio-returns-for-multiple-portfolios" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3a-aggregate-portfolio-returns-for-multiple-portfolios" class="anchor"></a>Step 3A: Aggregate Portfolio Returns for Multiple Portfolios</h4>
<p>This is where it gets fun. If you picked up on Single Portfolio, Step3A, Method 2 (mapping weights), this is just an extension for multiple portfolios.</p>
<p>First, we need to grow our portfolios. <code>tidyquant</code> has a handy, albeit simple, function, <code><a href="../reference/tq_portfolio.html">tq_repeat_df()</a></code>, for scaling a single portfolio to many. It takes a data frame, and the number of repeats, <code>n</code>, and the <code>index_col_name</code>, which adds a sequential index. Let’s see how it works for our example. We need three portfolios:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stock_returns_monthly_multi &lt;-<span class="st"> </span>stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_repeat_df</a></span>(<span class="dt">n =</span> <span class="dv">3</span>)
stock_returns_monthly_multi</code></pre></div>
<pre><code>## Source: local data frame [648 x 4]
## Groups: portfolio [3]
## 
##    portfolio symbol       date          Ra
##        &lt;int&gt;  &lt;chr&gt;     &lt;date&gt;       &lt;dbl&gt;
## 1          1   AAPL 2010-01-29 -0.10256526
## 2          1   AAPL 2010-02-26  0.06539619
## 3          1   AAPL 2010-03-31  0.14847041
## 4          1   AAPL 2010-04-30  0.11102125
## 5          1   AAPL 2010-05-28 -0.01612472
## 6          1   AAPL 2010-06-30 -0.02082686
## 7          1   AAPL 2010-07-30  0.02274081
## 8          1   AAPL 2010-08-31 -0.05500481
## 9          1   AAPL 2010-09-30  0.16721508
## 10         1   AAPL 2010-10-29  0.06072249
## # ... with 638 more rows</code></pre>
<p>Examining the results, we can see that a few things happened:</p>
<ol style="list-style-type: decimal">
<li>The length (number of rows) has tripled. This is the essence of <code>tq_repeat_df</code>: it grows the data frame length-wise, repeating the data frame <code>n</code> times. In our case, <code>n = 3</code>.</li>
<li>Our data frame, which was grouped by symbol, was ungrouped. This is needed to prevent <code>tq_portfolio</code> from blending on the individual stocks. <code>tq_portfolio</code> only works on groups of stocks.</li>
<li>We have a new column, named “portfolio”. The “portfolio” column name is a key that tells <code>tq_portfolio</code> that multiple groups exist to analyze. Just note that for multiple portfolio analysis, the “portfolio” column name is required.</li>
<li>We have three groups of portfolios. This is what <code>tq_portfolio</code> will split, apply (aggregate), then combine on.</li>
</ol>
<p>Now the tricky part: We need a new table of weights to map on. There’s a few requirements:</p>
<ol style="list-style-type: decimal">
<li>We must supply a three column tibble with the following columns: “portfolio”, asset, and weight in that order.</li>
<li>The “portfolio” column must be named “portfolio” since this is a key name for mapping.</li>
<li>The tibble must be grouped by the portfolio column.</li>
</ol>
<p>Here’s what the weights table should look like for our example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">weights &lt;-<span class="st"> </span><span class="kw">c</span>(
    <span class="fl">0.50</span>, <span class="fl">0.25</span>, <span class="fl">0.25</span>,
    <span class="fl">0.25</span>, <span class="fl">0.50</span>, <span class="fl">0.25</span>,
    <span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.50</span>
)
stocks &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"AAPL"</span>, <span class="st">"GOOG"</span>, <span class="st">"NFLX"</span>)
weights_table &lt;-<span class="st">  </span><span class="kw">tibble</span>(stocks) %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_repeat_df</a></span>(<span class="dt">n =</span> <span class="dv">3</span>) %&gt;%
<span class="st">    </span><span class="kw">bind_cols</span>(<span class="kw">tibble</span>(weights)) %&gt;%
<span class="st">    </span><span class="kw">group_by</span>(portfolio)
weights_table</code></pre></div>
<pre><code>## Source: local data frame [9 x 3]
## Groups: portfolio [3]
## 
##   portfolio stocks weights
##       &lt;int&gt;  &lt;chr&gt;   &lt;dbl&gt;
## 1         1   AAPL    0.50
## 2         1   GOOG    0.25
## 3         1   NFLX    0.25
## 4         2   AAPL    0.25
## 5         2   GOOG    0.50
## 6         2   NFLX    0.25
## 7         3   AAPL    0.25
## 8         3   GOOG    0.25
## 9         3   NFLX    0.50</code></pre>
<p>Now just pass the the expanded <code>stock_returns_monthly_multi</code> and the <code>weights_table</code> to <code>tq_portfolio</code> for portfolio aggregation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio_returns_monthly_multi &lt;-<span class="st"> </span>stock_returns_monthly_multi %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col  =</span> symbol, 
                 <span class="dt">returns_col =</span> Ra, 
                 <span class="dt">weights     =</span> weights_table, 
                 <span class="dt">col_rename  =</span> <span class="st">"Ra"</span>)
portfolio_returns_monthly_multi</code></pre></div>
<pre><code>## Source: local data frame [216 x 3]
## Groups: portfolio [3]
## 
##    portfolio       date            Ra
##        &lt;int&gt;     &lt;date&gt;         &lt;dbl&gt;
## 1          1 2010-01-29 -0.0489018445
## 2          1 2010-02-26  0.0482132938
## 3          1 2010-03-31  0.1233848612
## 4          1 2010-04-30  0.1446899884
## 5          1 2010-05-28  0.0245280152
## 6          1 2010-06-30 -0.0307681832
## 7          1 2010-07-30  0.0006001173
## 8          1 2010-08-31  0.0474360262
## 9          1 2010-09-30  0.2222062947
## 10         1 2010-10-29  0.0788975110
## # ... with 206 more rows</code></pre>
<p>Let’s assess the output. We now have a single, “long” format data frame of portfolio returns. It has three groups with the aggregated portfolios blended by mapping the <code>weight_table</code>.</p>
</div>
<div id="steps-3b-and-4-merging-and-assessing-performance" class="section level4">
<h4 class="hasAnchor">
<a href="#steps-3b-and-4-merging-and-assessing-performance" class="anchor"></a>Steps 3B and 4: Merging and Assessing Performance</h4>
<p>These steps are the exact same as the Single Portfolio example.</p>
<p>First, we merge with the baseline using “date” as the key.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio &lt;-<span class="st"> </span><span class="kw">left_join</span>(portfolio_returns_monthly_multi, 
                                     baseline_returns_monthly,
                                     <span class="dt">by =</span> <span class="st">"date"</span>)
RaRb_multiple_portfolio</code></pre></div>
<pre><code>## Source: local data frame [216 x 4]
## Groups: portfolio [?]
## 
##    portfolio       date            Ra          Rb
##        &lt;int&gt;     &lt;date&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1          1 2010-01-29 -0.0489018445 -0.09926952
## 2          1 2010-02-26  0.0482132938  0.03482833
## 3          1 2010-03-31  0.1233848612  0.06839787
## 4          1 2010-04-30  0.1446899884  0.01255411
## 5          1 2010-05-28  0.0245280152 -0.07481831
## 6          1 2010-06-30 -0.0307681832 -0.05396629
## 7          1 2010-07-30  0.0006001173  0.07450982
## 8          1 2010-08-31  0.0474360262 -0.05611312
## 9          1 2010-09-30  0.2222062947  0.11663646
## 10         1 2010-10-29  0.0788975110  0.05777587
## # ... with 206 more rows</code></pre>
<p>Finally, we calculate the performance of each of the portfolios using <code>tq_performance</code>. Make sure the data frame is grouped on “portfolio”.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.CAPM)</code></pre></div>
<pre><code>## Source: local data frame [3 x 13]
## Groups: portfolio [3]
## 
##   portfolio ActivePremium  Alpha AnnualizedAlpha   Beta `Beta-` `Beta+`
##       &lt;int&gt;         &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1         1        0.2294 0.0191          0.2549 0.9174  0.3425  0.7418
## 2         2        0.2175 0.0190          0.2538 0.8939  0.4581  0.6605
## 3         3        0.3167 0.0306          0.4355 0.7311 -0.1593  0.3944
## # ... with 6 more variables: Correlation &lt;dbl&gt;,
## #   `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;,
## #   TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;</code></pre>
<p>Inspecting the results, we now have a multiple portfolio comparison of the CAPM table from <code>PerformanceAnalytics</code>. We can do the same thing with <code>SharpeRatio</code> as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> SharpeRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio `ESSharpe(Rf=0%,p=95%)` `StdDevSharpe(Rf=0%,p=95%)`
##       &lt;int&gt;                   &lt;dbl&gt;                       &lt;dbl&gt;
## 1         1               0.1699068                   0.3509816
## 2         2               0.1451809                   0.3298835
## 3         3               0.1492360                   0.3141580
## # ... with 1 more variables: `VaRSharpe(Rf=0%,p=95%)` &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
<div id="available-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#available-functions" class="anchor"></a>Available Functions</h1>
<p>We’ve only scratched the surface of the analysis functions available through <code>PerformanceAnalytics</code>. The list below includes all of the compatible functions grouped by function type. The table functions are the most useful to get a cross section of metrics. We’ll touch on a few. We’ll also go over <code>VaR</code> and <code>SharpeRatio</code> as these are very commonly used as performance measures.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/tq_performance.html">tq_performance_fun_options</a></span>()</code></pre></div>
<pre><code>## $table.funs
##  [1] "table.AnnualizedReturns" "table.Arbitrary"        
##  [3] "table.Autocorrelation"   "table.CAPM"             
##  [5] "table.CaptureRatios"     "table.Correlation"      
##  [7] "table.Distributions"     "table.DownsideRisk"     
##  [9] "table.DownsideRiskRatio" "table.DrawdownsRatio"   
## [11] "table.HigherMoments"     "table.InformationRatio" 
## [13] "table.SFM"               "table.SpecificRisk"     
## [15] "table.Stats"             "table.TrailingPeriods"  
## [17] "table.UpDownRatios"      "table.Variability"      
## 
## $CAPM.funs
##  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.beta.bear"  
##  [4] "CAPM.beta.bull"   "CAPM.CML"         "CAPM.CML.slope"  
##  [7] "CAPM.dynamic"     "CAPM.epsilon"     "CAPM.jensenAlpha"
## [10] "CAPM.RiskPremium" "CAPM.SML.slope"   "TimingRatio"     
## [13] "MarketTiming"    
## 
## $SFM.funs
## [1] "SFM.alpha"       "SFM.beta"        "SFM.CML"         "SFM.CML.slope"  
## [5] "SFM.dynamic"     "SFM.epsilon"     "SFM.jensenAlpha"
## 
## $descriptive.funs
## [1] "mean"           "sd"             "min"            "max"           
## [5] "cor"            "mean.geometric" "mean.stderr"    "mean.LCL"      
## [9] "mean.UCL"      
## 
## $annualized.funs
## [1] "Return.annualized"        "Return.annualized.excess"
## [3] "sd.annualized"            "SharpeRatio.annualized"  
## 
## $VaR.funs
## [1] "VaR"  "ES"   "ETL"  "CDD"  "CVaR"
## 
## $moment.funs
##  [1] "var"              "cov"              "skewness"        
##  [4] "kurtosis"         "CoVariance"       "CoSkewness"      
##  [7] "CoSkewnessMatrix" "CoKurtosis"       "CoKurtosisMatrix"
## [10] "M3.MM"            "M4.MM"            "BetaCoVariance"  
## [13] "BetaCoSkewness"   "BetaCoKurtosis"  
## 
## $drawdown.funs
## [1] "AverageDrawdown"   "AverageLength"     "AverageRecovery"  
## [4] "DrawdownDeviation" "DrawdownPeak"      "maxDrawdown"      
## 
## $Bacon.risk.funs
## [1] "MeanAbsoluteDeviation" "Frequency"             "SharpeRatio"          
## [4] "MSquared"              "MSquaredExcess"        "HurstIndex"           
## 
## $Bacon.regression.funs
##  [1] "CAPM.alpha"       "CAPM.beta"        "CAPM.epsilon"    
##  [4] "CAPM.jensenAlpha" "SystematicRisk"   "SpecificRisk"    
##  [7] "TotalRisk"        "TreynorRatio"     "AppraisalRatio"  
## [10] "FamaBeta"         "Selectivity"      "NetSelectivity"  
## 
## $Bacon.relative.risk.funs
## [1] "ActivePremium"    "ActiveReturn"     "TrackingError"   
## [4] "InformationRatio"
## 
## $Bacon.drawdown.funs
## [1] "PainIndex"     "PainRatio"     "CalmarRatio"   "SterlingRatio"
## [5] "BurkeRatio"    "MartinRatio"   "UlcerIndex"   
## 
## $Bacon.downside.risk.funs
##  [1] "DownsideDeviation"     "DownsidePotential"    
##  [3] "DownsideFrequency"     "SemiDeviation"        
##  [5] "SemiVariance"          "UpsideRisk"           
##  [7] "UpsidePotentialRatio"  "UpsideFrequency"      
##  [9] "BernardoLedoitRatio"   "DRatio"               
## [11] "Omega"                 "OmegaSharpeRatio"     
## [13] "OmegaExcessReturn"     "SortinoRatio"         
## [15] "M2Sortino"             "Kappa"                
## [17] "VolatilitySkewness"    "AdjustedSharpeRatio"  
## [19] "SkewnessKurtosisRatio" "ProspectRatio"        
## 
## $misc.funs
## [1] "KellyRatio"   "Modigliani"   "UpDownRatios"</code></pre>
<div id="table-stats" class="section level2">
<h2 class="hasAnchor">
<a href="#table-stats" class="anchor"></a>table.Stats</h2>
<p>Returns a basic set of statistics that match the period of the data passed in (e.g., monthly returns will get monthly statistics, daily will be daily stats, and so on).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> table.Stats)</code></pre></div>
<pre><code>## Source: local data frame [3 x 17]
## Groups: portfolio [3]
## 
##   portfolio ArithmeticMean GeometricMean Kurtosis `LCLMean(0.95)` Maximum
##       &lt;int&gt;          &lt;dbl&gt;         &lt;dbl&gt;    &lt;dbl&gt;           &lt;dbl&gt;   &lt;dbl&gt;
## 1         1         0.0290        0.0257   1.0984          0.0096  0.2222
## 2         2         0.0287        0.0249   1.6075          0.0083  0.2270
## 3         3         0.0385        0.0310   1.7844          0.0097  0.3699
## # ... with 11 more variables: Median &lt;dbl&gt;, Minimum &lt;dbl&gt;, NAs &lt;dbl&gt;,
## #   Observations &lt;dbl&gt;, Quartile1 &lt;dbl&gt;, Quartile3 &lt;dbl&gt;, SEMean &lt;dbl&gt;,
## #   Skewness &lt;dbl&gt;, Stdev &lt;dbl&gt;, `UCLMean(0.95)` &lt;dbl&gt;, Variance &lt;dbl&gt;</code></pre>
</div>
<div id="table-capm" class="section level2">
<h2 class="hasAnchor">
<a href="#table-capm" class="anchor"></a>table.CAPM</h2>
<p>Takes a set of returns and relates them to a benchmark return. Provides a set of measures related to an excess return single factor model, or CAPM.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.CAPM)</code></pre></div>
<pre><code>## Source: local data frame [3 x 13]
## Groups: portfolio [3]
## 
##   portfolio ActivePremium  Alpha AnnualizedAlpha   Beta `Beta-` `Beta+`
##       &lt;int&gt;         &lt;dbl&gt;  &lt;dbl&gt;           &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
## 1         1        0.2294 0.0191          0.2549 0.9174  0.3425  0.7418
## 2         2        0.2175 0.0190          0.2538 0.8939  0.4581  0.6605
## 3         3        0.3167 0.0306          0.4355 0.7311 -0.1593  0.3944
## # ... with 6 more variables: Correlation &lt;dbl&gt;,
## #   `Correlationp-value` &lt;dbl&gt;, InformationRatio &lt;dbl&gt;, `R-squared` &lt;dbl&gt;,
## #   TrackingError &lt;dbl&gt;, TreynorRatio &lt;dbl&gt;</code></pre>
</div>
<div id="table-annualizedreturns" class="section level2">
<h2 class="hasAnchor">
<a href="#table-annualizedreturns" class="anchor"></a>table.AnnualizedReturns</h2>
<p>Table of Annualized Return, Annualized Std Dev, and Annualized Sharpe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> table.AnnualizedReturns)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio AnnualizedReturn `AnnualizedSharpe(Rf=0%)` AnnualizedStdDev
##       &lt;int&gt;            &lt;dbl&gt;                     &lt;dbl&gt;            &lt;dbl&gt;
## 1         1           0.3553                    1.2395           0.2866
## 2         2           0.3434                    1.1391           0.3015
## 3         3           0.4427                    1.0426           0.4246</code></pre>
</div>
<div id="table-correlation" class="section level2">
<h2 class="hasAnchor">
<a href="#table-correlation" class="anchor"></a>table.Correlation</h2>
<p>This is a wrapper for calculating correlation and significance against each column of the data provided.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.Correlation)</code></pre></div>
<pre><code>## Source: local data frame [3 x 5]
## Groups: portfolio [3]
## 
##   portfolio    `p-value` `Lower CI` `Upper CI`     to.Rb
##       &lt;int&gt;        &lt;dbl&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1         1 2.362576e-05 0.27478777  0.6374931 0.4761451
## 2         2 1.053540e-04 0.23323261  0.6103690 0.4410690
## 3         3 2.984743e-02 0.02605867  0.4605179 0.2561807</code></pre>
</div>
<div id="table-downsiderisk" class="section level2">
<h2 class="hasAnchor">
<a href="#table-downsiderisk" class="anchor"></a>table.DownsideRisk</h2>
<p>Creates a table of estimates of downside risk measures for comparison across multiple instruments or funds.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> table.DownsideRisk)</code></pre></div>
<pre><code>## Source: local data frame [3 x 12]
## Groups: portfolio [3]
## 
##   portfolio `DownsideDeviation(0%)` `DownsideDeviation(MAR=10%)`
##       &lt;int&gt;                   &lt;dbl&gt;                        &lt;dbl&gt;
## 1         1                  0.0453                       0.0492
## 2         2                  0.0503                       0.0541
## 3         3                  0.0687                       0.0723
## # ... with 9 more variables: `DownsideDeviation(Rf=0%)` &lt;dbl&gt;,
## #   GainDeviation &lt;dbl&gt;, `HistoricalES(95%)` &lt;dbl&gt;,
## #   `HistoricalVaR(95%)` &lt;dbl&gt;, LossDeviation &lt;dbl&gt;,
## #   MaximumDrawdown &lt;dbl&gt;, `ModifiedES(95%)` &lt;dbl&gt;,
## #   `ModifiedVaR(95%)` &lt;dbl&gt;, SemiDeviation &lt;dbl&gt;</code></pre>
</div>
<div id="table-downsideriskratio" class="section level2">
<h2 class="hasAnchor">
<a href="#table-downsideriskratio" class="anchor"></a>table.DownsideRiskRatio</h2>
<p>Table of Monthly downside risk, Annualized downside risk, Downside potential, Omega, Sortino ratio, Upside potential, Upside potential ratio and Omega-Sharpe ratio.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> table.DownsideRiskRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 9]
## Groups: portfolio [3]
## 
##   portfolio Annualiseddownsiderisk Downsidepotential Monthlydownsiderisk
##       &lt;int&gt;                  &lt;dbl&gt;             &lt;dbl&gt;               &lt;dbl&gt;
## 1         1                 0.1571            0.0201              0.0453
## 2         2                 0.1743            0.0220              0.0503
## 3         3                 0.2378            0.0296              0.0687
## # ... with 5 more variables: Omega &lt;dbl&gt;, `Omega-sharperatio` &lt;dbl&gt;,
## #   Sortinoratio &lt;dbl&gt;, Upsidepotential &lt;dbl&gt;, Upsidepotentialratio &lt;dbl&gt;</code></pre>
</div>
<div id="table-highermoments" class="section level2">
<h2 class="hasAnchor">
<a href="#table-highermoments" class="anchor"></a>table.HigherMoments</h2>
<p>Summary of the higher moments and Co-Moments of the return distribution. Used to determine diversification potential. Also called “systematic” moments by several papers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.HigherMoments)</code></pre></div>
<pre><code>## Source: local data frame [3 x 6]
## Groups: portfolio [3]
## 
##   portfolio BetaCoKurtosis BetaCoSkewness BetaCoVariance CoKurtosis
##       &lt;int&gt;          &lt;dbl&gt;          &lt;dbl&gt;          &lt;dbl&gt;      &lt;dbl&gt;
## 1         1         0.7593         0.2388         0.9174          0
## 2         2         0.7748         2.0455         0.8939          0
## 3         3         0.4591         0.5073         0.7311          0
## # ... with 1 more variables: CoSkewness &lt;dbl&gt;</code></pre>
</div>
<div id="table-informationratio" class="section level2">
<h2 class="hasAnchor">
<a href="#table-informationratio" class="anchor"></a>table.InformationRatio</h2>
<p>Table of Tracking error, Annualized tracking error and Information ratio.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> Rb, <span class="dt">performance_fun =</span> table.InformationRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio AnnualisedTrackingError InformationRatio TrackingError
##       &lt;int&gt;                   &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;
## 1         1                  0.2524           0.9088        0.0729
## 2         2                  0.2711           0.8024        0.0782
## 3         3                  0.4124           0.7681        0.1190</code></pre>
</div>
<div id="table-variability" class="section level2">
<h2 class="hasAnchor">
<a href="#table-variability" class="anchor"></a>table.Variability</h2>
<p>Table of Mean absolute difference, Monthly standard deviation and annualized standard deviation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> table.Variability)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio AnnualizedStdDev MeanAbsolutedeviation MonthlyStdDev
##       &lt;int&gt;            &lt;dbl&gt;                 &lt;dbl&gt;         &lt;dbl&gt;
## 1         1           0.2866                0.0660        0.0827
## 2         2           0.3015                0.0682        0.0870
## 3         3           0.4246                0.0913        0.1226</code></pre>
</div>
<div id="var" class="section level2">
<h2 class="hasAnchor">
<a href="#var" class="anchor"></a>VaR</h2>
<p>Calculates Value-at-Risk (VaR) for univariate, component, and marginal cases using a variety of analytical methods.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> VaR)</code></pre></div>
<pre><code>## Source: local data frame [3 x 2]
## Groups: portfolio [3]
## 
##   portfolio        VaR
##       &lt;int&gt;      &lt;dbl&gt;
## 1         1 -0.1120763
## 2         2 -0.1233272
## 3         3 -0.1635992</code></pre>
</div>
<div id="sharperatio" class="section level2">
<h2 class="hasAnchor">
<a href="#sharperatio" class="anchor"></a>SharpeRatio</h2>
<p>The Sharpe ratio is simply the return per unit of risk (represented by variability). In the classic case, the unit of risk is the standard deviation of the returns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra =</span> Ra, <span class="dt">Rb =</span> <span class="ot">NULL</span>, <span class="dt">performance_fun =</span> SharpeRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio `ESSharpe(Rf=0%,p=95%)` `StdDevSharpe(Rf=0%,p=95%)`
##       &lt;int&gt;                   &lt;dbl&gt;                       &lt;dbl&gt;
## 1         1               0.1699068                   0.3509816
## 2         2               0.1451809                   0.3298835
## 3         3               0.1492360                   0.3141580
## # ... with 1 more variables: `VaRSharpe(Rf=0%,p=95%)` &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="customizing-using-the" class="section level1">
<h1 class="hasAnchor">
<a href="#customizing-using-the" class="anchor"></a>Customizing using the …</h1>
<p>One of the best features of <code>tq_portfolio</code> and <code>tq_performance</code> is to be able to pass features through to the underlying functions. After all, these are just wrappers for <code>PerformanceAnalytics</code>, so you probably want to be able <strong>to make full use of the underlying functions</strong>. Passing through parameters using the <code>...</code> can be incredibly useful, so let’s see how.</p>
<div id="customizing-tq_portfolio" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-tq_portfolio" class="anchor"></a>Customizing tq_portfolio</h2>
<p>The <code>tq_portfolio</code> function is a wrapper for <code>Return.portfolio</code>. This means that during the portfolio aggregation process, we can make use of most of the <code>Return.portfolio</code> arguments such as <code>wealth.index</code>, <code>contribution</code>, <code>geometric</code>, <code>rebalance_on</code>, and <code>value</code>. Here’s the arguments of the underlying function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(Return.portfolio)</code></pre></div>
<pre><code>## function (R, weights = NULL, wealth.index = FALSE, contribution = FALSE, 
##     geometric = TRUE, rebalance_on = c(NA, "years", "quarters", 
##         "months", "weeks", "days"), value = 1, verbose = FALSE, 
##     ...) 
## NULL</code></pre>
<p>Let’s see an example of passing parameters to the <code>...</code>. Suppose we want to instead see how our money is grows for a $10,000 investment. We’ll use the “Single Portfolio” example, where our portfolio mix was 50% AAPL, 0% GOOG, and 50% NFLX.</p>
<p>Method 3A, Aggregating Portfolio Returns, showed us two methods to aggregate for a single portfolio. Either will work for this example. For simplicity, we’ll examine the first.</p>
<p>Here’s the original output, without adjusting parameters.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="fl">0.0</span>, <span class="fl">0.5</span>)
portfolio_returns_monthly &lt;-<span class="st"> </span>stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col  =</span> symbol, 
                 <span class="dt">returns_col =</span> Ra, 
                 <span class="dt">weights     =</span> wts, 
                 <span class="dt">col_rename  =</span> <span class="st">"Ra"</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio_returns_monthly %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> Ra)) +
<span class="st">    </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">"identity"</span>, <span class="dt">fill =</span> <span class="kw"><a href="../reference/palette_tq.html">palette_light</a></span>()[[<span class="dv">1</span>]]) +
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Portfolio Returns"</span>,
         <span class="dt">subtitle =</span> <span class="st">"50% AAPL, 0% GOOG, and 50% NFLX"</span>,
         <span class="dt">caption =</span> <span class="st">"Shows an above-zero trend meaning positive returns"</span>,
         <span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">"Monthly Returns"</span>) +
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"lm"</span>) +
<span class="st">    </span><span class="kw"><a href="../reference/theme_tq.html">theme_tq</a></span>() +
<span class="st">    </span><span class="kw"><a href="../reference/scale_manual.html">scale_color_tq</a></span>() +
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales::percent)</code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-44-1.png" width="576"></p>
<p>This is good, but we want to see how our $10,000 initial investment is growing. This is simple with the underlying <code>Return.portfolio</code> argument, <code>wealth.index = TRUE</code>. All we need to do is add these as additional parameters to <code>tq_portfolio</code>!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wts &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)
portfolio_growth_monthly &lt;-<span class="st"> </span>stock_returns_monthly %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col   =</span> symbol, 
                 <span class="dt">returns_col  =</span> Ra, 
                 <span class="dt">weights      =</span> wts, 
                 <span class="dt">col_rename   =</span> <span class="st">"investment.growth"</span>,
                 <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">investment.growth =</span> investment.growth *<span class="st"> </span><span class="dv">10000</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio_growth_monthly %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> investment.growth)) +
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="kw"><a href="../reference/palette_tq.html">palette_light</a></span>()[[<span class="dv">1</span>]]) +
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Portfolio Growth"</span>,
         <span class="dt">subtitle =</span> <span class="st">"50% AAPL, 0% GOOG, and 50% NFLX"</span>,
         <span class="dt">caption =</span> <span class="st">"Now we can really visualize performance!"</span>,
         <span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">"Portfolio Value"</span>) +
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"loess"</span>) +
<span class="st">    </span><span class="kw"><a href="../reference/theme_tq.html">theme_tq</a></span>() +
<span class="st">    </span><span class="kw"><a href="../reference/scale_manual.html">scale_color_tq</a></span>() +
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales::dollar)</code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-46-1.png" width="576"></p>
<p>Finally, taking this one step further, we apply the same process to the “Multiple Portfolio” example:</p>
<ol style="list-style-type: decimal">
<li>50% AAPL, 25% GOOG, 25% NFLX</li>
<li>25% AAPL, 50% GOOG, 25% NFLX</li>
<li>25% AAPL, 25% GOOG, 50% NFLX</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio_growth_monthly_multi &lt;-<span class="st"> </span>stock_returns_monthly_multi %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_portfolio.html">tq_portfolio</a></span>(<span class="dt">assets_col   =</span> symbol, 
                 <span class="dt">returns_col  =</span> Ra, 
                 <span class="dt">weights      =</span> weights_table, 
                 <span class="dt">col_rename   =</span> <span class="st">"investment.growth"</span>,
                 <span class="dt">wealth.index =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">investment.growth =</span> investment.growth *<span class="st"> </span><span class="dv">10000</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">portfolio_growth_monthly_multi %&gt;%
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> investment.growth, <span class="dt">color =</span> <span class="kw">factor</span>(portfolio))) +
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="dv">2</span>) +
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Portfolio Growth"</span>,
         <span class="dt">subtitle =</span> <span class="st">"Comparing Multiple Portfolios"</span>,
         <span class="dt">caption =</span> <span class="st">"Portfolio 3 is a Standout!"</span>,
         <span class="dt">x =</span> <span class="st">""</span>, <span class="dt">y =</span> <span class="st">"Portfolio Value"</span>,
         <span class="dt">color =</span> <span class="st">"Portfolio"</span>) +
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">"loess"</span>) +
<span class="st">    </span><span class="kw"><a href="../reference/theme_tq.html">theme_tq</a></span>() +
<span class="st">    </span><span class="kw"><a href="../reference/scale_manual.html">scale_color_tq</a></span>() +
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales::dollar)</code></pre></div>
<p><img src="TQ05-performance-analysis-with-tidyquant_files/figure-html/unnamed-chunk-48-1.png" width="576"></p>
</div>
<div id="customizing-tq_performance" class="section level2">
<h2 class="hasAnchor">
<a href="#customizing-tq_performance" class="anchor"></a>Customizing tq_performance</h2>
<p>Finally, the same concept of passing arguments works with all the <code>tidyquant</code> functions that are wrappers including <code>tq_transmute</code>, <code>tq_mutate</code>, <code>tq_performance</code>, etc. Let’s use a final example with the <code>SharpeRatio</code>, which has the following arguments.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">args</span>(SharpeRatio)</code></pre></div>
<pre><code>## function (R, Rf = 0, p = 0.95, FUN = c("StdDev", "VaR", "ES"), 
##     weights = NULL, annualize = FALSE, ...) 
## NULL</code></pre>
<p>We can see that the parameters <code>Rf</code> allows us to apply a risk-free rate and <code>p</code> allows us to vary the confidence interval. Let’s compare the Sharpe ratio with an annualized risk-free rate of 3% and a confidence interval of 0.99.</p>
<p>Default:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra              =</span> Ra, 
                   <span class="dt">performance_fun =</span> SharpeRatio)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio `ESSharpe(Rf=0%,p=95%)` `StdDevSharpe(Rf=0%,p=95%)`
##       &lt;int&gt;                   &lt;dbl&gt;                       &lt;dbl&gt;
## 1         1               0.1699068                   0.3509816
## 2         2               0.1451809                   0.3298835
## 3         3               0.1492360                   0.3141580
## # ... with 1 more variables: `VaRSharpe(Rf=0%,p=95%)` &lt;dbl&gt;</code></pre>
<p>With <code>Rf = 0.03 / 12</code> (adjusted for monthly periodicity):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra              =</span> Ra, 
                   <span class="dt">performance_fun =</span> SharpeRatio,
                   <span class="dt">Rf              =</span> <span class="fl">0.03</span> /<span class="st"> </span><span class="dv">12</span>)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio `ESSharpe(Rf=0.2%,p=95%)` `StdDevSharpe(Rf=0.2%,p=95%)`
##       &lt;int&gt;                     &lt;dbl&gt;                         &lt;dbl&gt;
## 1         1                 0.1552815                     0.3207696
## 2         2                 0.1325399                     0.3011603
## 3         3                 0.1395468                     0.2937612
## # ... with 1 more variables: `VaRSharpe(Rf=0.2%,p=95%)` &lt;dbl&gt;</code></pre>
<p>And, with both <code>Rf = 0.03 / 12</code> (adjusted for monthly periodicity) and <code>p = 0.99</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">RaRb_multiple_portfolio %&gt;%
<span class="st">    </span><span class="kw"><a href="../reference/tq_performance.html">tq_performance</a></span>(<span class="dt">Ra              =</span> Ra, 
                   <span class="dt">performance_fun =</span> SharpeRatio,
                   <span class="dt">Rf              =</span> <span class="fl">0.03</span> /<span class="st"> </span><span class="dv">12</span>, 
                   <span class="dt">p               =</span> <span class="fl">0.99</span>)</code></pre></div>
<pre><code>## Source: local data frame [3 x 4]
## Groups: portfolio [3]
## 
##   portfolio `ESSharpe(Rf=0.2%,p=99%)` `StdDevSharpe(Rf=0.2%,p=99%)`
##       &lt;int&gt;                     &lt;dbl&gt;                         &lt;dbl&gt;
## 1         1                0.10407622                     0.3207696
## 2         2                0.09374465                     0.3011603
## 3         3                0.09063379                     0.2937612
## # ... with 1 more variables: `VaRSharpe(Rf=0.2%,p=99%)` &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#key-concepts">Key Concepts</a></li>
      <li><a href="#quick-example">Quick Example</a></li>
      <li>
<a href="#workflow">Workflow</a><ul class="nav nav-pills nav-stacked">
<li><a href="#individual-assets">Individual Assets</a></li>
      <li><a href="#portfolios-asset-groups">Portfolios (Asset Groups)</a></li>
      </ul>
</li>
      <li>
<a href="#available-functions">Available Functions</a><ul class="nav nav-pills nav-stacked">
<li><a href="#table.stats">table.Stats</a></li>
      <li><a href="#table.capm">table.CAPM</a></li>
      <li><a href="#table.annualizedreturns">table.AnnualizedReturns</a></li>
      <li><a href="#table.correlation">table.Correlation</a></li>
      <li><a href="#table.downsiderisk">table.DownsideRisk</a></li>
      <li><a href="#table.downsideriskratio">table.DownsideRiskRatio</a></li>
      <li><a href="#table.highermoments">table.HigherMoments</a></li>
      <li><a href="#table.informationratio">table.InformationRatio</a></li>
      <li><a href="#table.variability">table.Variability</a></li>
      <li><a href="#var">VaR</a></li>
      <li><a href="#sharperatio">SharpeRatio</a></li>
      </ul>
</li>
      <li>
<a href="#customizing-using-the">Customizing using the …</a><ul class="nav nav-pills nav-stacked">
<li><a href="#customizing-tq_portfolio">Customizing tq_portfolio</a></li>
      <li><a href="#customizing-tq_performance">Customizing tq_performance</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Matt Dancho, Davis Vaughan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
